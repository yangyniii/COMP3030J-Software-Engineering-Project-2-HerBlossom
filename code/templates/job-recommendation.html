<!doctype html>
<html lang="en">


<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="../static/img/favicon.ico" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../static/assets/bootstrap/css/bootstrap.min.css">
    <!-- icon css_test-->
    <link rel="stylesheet" href="../static/assets/elagent-icon/style.css">
    <link rel="stylesheet" href="../static/assets/animation/animate.css">
    <link rel="stylesheet" href="../static/css_test/style.css">
    <link rel="stylesheet" href="../static/css_test/responsive.css">
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    />

    <title>HerBlossom</title>
</head>

<body data-scroll-animation="true">
    <div id="preloader">
        <div id="ctn-preloader" class="ctn-preloader">
            <div class="round_spinner">
                <div class="spinner"></div>
                <div class="text">
                    <img src="../static/img/spinner_logo.png" alt="">
                    <h4><span>HerBlossom</span></h4>
                </div>
            </div>
            <h2 class="head">Did You Know?</h2>
            <p></p>
        </div>
    </div>

    <div class="body_wrapper">
        <nav class="navbar navbar-expand-lg menu_one" id="sticky">
            <div class="container">
                <a class="navbar-brand sticky_logo" href="/index">
                    <img src="../static/img/logo.png" srcset="../static/img/logo-w.png 2x" alt="logo">
                </a>
                <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="menu_toggle">
                        <span class="hamburger">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                        <span class="hamburger-cross">
                            <span></span>
                            <span></span>
                        </span>
                    </span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav menu ml-auto">
                        <li class="nav-item dropdown submenu">
                            <a href="/index" class="nav-link dropdown-toggle" role="button" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">Home</a>
                            <i class="arrow_carrot-down_alt2 mobile_dropdown_icon" aria-hidden="true"
                               data-toggle="dropdown"></i>
                            <!--?                            <ul class="dropdown-menu">-->
                            <!--?                               <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>-->
                            <!--?                            </ul>-->
                        </li>
                        <li class="nav-item dropdown submenu mega_menu tab-demo">
                            <a href="/forum-topics" class="nav-link dropdown-toggle" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Forum</a>
                            <i class="arrow_carrot-down_alt2 mobile_dropdown_icon" aria-hidden="true"
                               data-toggle="dropdown"></i>
                        </li>
                        <li class="nav-item dropdown submenu mega_menu tab-demo">
                            <a href="/blog" class="nav-link dropdown-toggle" role="button" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">Blog</a>
                        </li>
                        <li class="nav-item dropdown submenu mega_menu tab-demo">
                            <a href="#" class="nav-link dropdown-toggle" role="button" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">Job Recommendation</a>
                        </li>
                        <li class="nav-item dropdown submenu">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Products
                            </a>
                            <i class="arrow_carrot-down_alt2 mobile_dropdown_icon" aria-hidden="false" data-toggle="dropdown"></i>
                            <ul class="dropdown-menu dropdown_menu_two">
                                <li class="nav-item">
                                    <a href="contact.html" class="nav-link">
                                        <img src="../static/img/tick.png" alt="">
                                        <div class="text">
                                            <h5>Content Us</h5>
                                            <p>Send your feedback here!</p>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="aboutus.html" class="nav-link">
                                        <img src="../static/img/sheet.png" alt="">
                                        <div class="text">
                                            <h5>About Us</h5>
                                            <p>Want to know more about<br>QUEENs NEVER CRY?</p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <a class="nav_btn" href="signin.html">Sign In</a>
                </div>
            </div>
        </nav>

        <section class="breadcrumb_area">
            <img class="p_absolute bl_left" src="../static/img/v.svg" alt="">
            <img class="p_absolute bl_right" src="../static/img/home_one/b_leaf.svg" alt="">
            <img class="p_absolute star" src="../static/img/home_one/banner_bg.png" alt="">
            <img class="p_absolute wave_shap_one" src="../static/img/blog-classic/shap_01.png" alt="">
            <img class="p_absolute wave_shap_two" src="../static/img/blog-classic/shap_02.png" alt="">
            <img class="p_absolute one wow fadeInRight" src="../static/img/home_one/girl_img.png" alt="">
            <img class="p_absolute two wow fadeInUp" data-wow-delay="0.2s" src="../static/img/home_one/flower.png" alt="">
            <div class="container">
                <form action="/job-recommendation" method="GET" class="banner_search_form">
                    <div class="input-group">
                        <input id="search-input" type="search" name="keyword" class="form-control" placeholder="Search any job here"
                               value="{{ keyword if keyword else '' }}">
                        <div class="input-group-append">
                            <button id="search-button"  type="submit" class="btn btn-primary">
                                <i class="icon_search"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

        </section>
        <section class="page_breadcrumb">
            <div class="container">
                <div class="row">
                    <div class="col-sm-7">
                        <nav aria-label="breadcrumb">
                          <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/index">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Job Recommendation</li>
                          </ol>
                        </nav>
                    </div>
                    <div class="col-sm-5">
                        <a href="#" class="date"><i class="icon_clock_alt"></i>Updated on {{ featured_job.publish_date if featured_job else 'April 03, 2025' }}</a>
                    </div>
                </div>
            </div>
        </section>

       <!-- job-recommendation.html 的内容继续 -->
<section class="job_filter_section py-4">
    <div class="container">
        <div class="d-flex flex-wrap gap-3">
            <div class="filter-tag position-relative">
                <select class="form-select" id="locationFilter">
                    <option value="">Locations</option>
                    <option value="Beijing">Beijing</option>
                    <option value="Chengdu">Chengdu</option>
                    <option value="Shenzhen">Shenzhen</option>
                    <option value="Hangzhou">Hangzhou</option>
                     <option value="Nanjing">Nanjing</option>
                    <option value="Shanghai">Shanghai</option>
                    <option value="Shenzhen">Shenzhen</option>
                    <option value="Tianjin">Tianjin</option>
                    <option value="Wuhan">Wuhan</option>

                </select>

            </div>
            <div class="filter-tag position-relative">
                <select class="form-select" id="tagFilter">
                    <option value="">tags</option>
                    <option value="Care">Care</option>
                     <option value="E-commerce">E-commerce</option>
                    <option value="Education">Education</option>
                    <option value="Entry Level">Entry Level</option>
                    <option value="Express">Express</option>
                    <option value="Logistics">Logistics</option>
                    <option value="Parenting">Parenting</option>
                    <option value="Remote Work">Remote Work</option>
                    <option value="Service">Service</option>
                     <option value="Tech Jobs">Tech Jobs</option>
                </select>
            </div>
            <div class="filter-tag position-relative">
                <select class="form-select" id="salaryFilter">
                    <option value="">Salaries</option>
                    <option value="0-5k">0-5k</option>
                    <option value="5k-10k">5k-10k</option>
                    <option value="10k-15k">10k-15k</option>
                    <option value="15k-20k">15k-20k</option>
                    <option value="20k+">20k+</option>
                </select>
            </div>
            <div class="filter-tag position-relative">
                <select class="form-select" id="educationFilter">
                    <option value="">Educations</option>
                    <option value="No requirements">No requirements</option>
                    <option value="Junior High">Junior High</option>
                    <option value="High School">High School</option>
                    <option value="Bachelor's degree">Bachelor's degree</option>
                </select>
            </div>
            <div class="filter-tag position-relative">
                <select class="form-select" id="companyFilter">
                    <option value="">Company</option>
                     <option value="AI ">AI </option>
                    <option value="Cleaning">Cleaning</option>
                    <option value="Express">Express</option>
                    <option value="Hotel">Hotel</option>
                      <option value="Logistics">Logistics</option>
                    <option value="Parenting">Parenting</option>
                    <option value="Restaurant">Restaurant</option>
                    <option value="Service">Service</option>
                    <option value="Parenting">Parenting</option>



                </select>
            </div>
        </div>
    </div>
</section>

<!-- 主体内容 -->
<section class="job_listings_section py-4">
    <div class="container d-flex flex-row gap-4">
        <!-- 左侧职位概览 -->
        <div class="left_panel border p-3 bg-white shadow-sm rounded-3" style="width: 40%; height: 800px; overflow-y: auto; min-width: 400px;">
            <div id="job_list">
                {% if job_list|length == 0 %}
                    <p class="text-muted text-center py-4">No job listings found. Please try searching again.</p>
                {% else %}
                    {% for job in job_list %}
                    <div class="job_summary border rounded-3 p-3 mb-3 bg-light shadow-sm hover-shadow transition-all"
                         onclick="showJobDetail('{{ job.job_id }}')"
                         style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="d-flex justify-content-between align-items-start">
                            <h5 class="mb-3">{{ job.title }}</h5>
                            <span class="badge bg-success">{{ job.salary }}</span>
                        </div>
                        <div class="job-meta text-muted mb-2">
                            <small>
                                <i class="fas fa-map-marker-alt"></i> 📍 {{ job.location }} |
                                <i class="fas fa-briefcase"></i> 🧰 {{ job.experience }} |
                                <i class="fas fa-graduation-cap"></i> 🎓 {{ job.education }}
                            </small>
                        </div>
                        <p class="mb-2">{{ job.short_desc }}</p>
                        <div class="job-tags mt-3">
                            {% for tag in job.tags.split(',') %}
                                <span class="badge bg-light text-dark border me-2">{{ tag.strip() }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- 右侧详细信息 -->
        <div class="right_panel border p-4 bg-white shadow-sm rounded-3 flex-fill"
             style="width: 60%; height: 800px; overflow-y: auto; min-width: 600px;">
            <div id="job_detail">
                {% if job_list|length == 0 %}
                <div class="text-center py-5">
                    <i class="fas fa-info-circle fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No job listings found. Please try searching again.</p>
                </div>
                {% else %}
                {% for job in job_list %}
                <div
                        id="{{ job.job_id }}"
                        class="job_detail {% if not loop.first %}d-none{% endif %}"
                        data-lat="{{ job.latitude }}"
                        data-lng="{{ job.longitude }}"
                >
                    <div class="job-header border-bottom pb-3 mb-4">
                        <h4 class="mb-3">{{ job.title }}</h4>
                        <div class="job-meta d-flex flex-wrap gap-3">
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt text-danger"></i>
                                <strong>Location: </strong>{{ job.location }}
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-briefcase text-warning"></i>
                                <strong>Experience: </strong>{{ job.experience }}
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-graduation-cap text-info"></i>
                                <strong>Education：</strong>{{ job.education }}
                            </div>
                        </div>
                        <div class="job-tags mt-3">
                            {% for tag in job.tags.split(',') %}
                            <span class="badge bg-light text-dark border me-2">{{ tag.strip() }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="job-description">
                        <h5 class="mb-3">Description:</h5>
                        <p><strong></strong></p>
                        <div class="job-tags mb-3">
                            {% for tag in job.tags.split(',') %}
                            <span class="badge bg-light text-dark border me-2">{{ tag.strip() }}</span>
                            {% endfor %}
                        </div>
                        <ul class="list-unstyled">
                            {% for line in job.full_desc.split('\n') %}
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                {{ line }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>

            <!-- 地图区域 -->
            <div id="map"
                 style="width:100%; height:400px; margin-top:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);"></div>
        </div>
    </div>
</section>

<style>
    @import 'https://fonts.googleapis.com/css?family=Roboto';




/* Add hover shadow effect */
select.form-select:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;

}

    .hover-shadow:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
    }

    .transition-all {
        transition: all 0.3s ease;
    }

    .job-meta .meta-item {
        background: #f8f9fa;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
         border: 3px solid #f8c8dc; /* 浅粉色边框 */
        border-radius: 10px; /* 圆角 */
        margin-right: 10px;
    }

    .job-description li {
        padding: 0.5rem 0;
        border-bottom: 1px dashed #eee;
    }

    .job-description li:last-child {
        border-bottom: none;
    }




    select.form-select {
  display: inline-block;
  margin: 0.75rem;
  padding: 0.75rem 1.5rem;
  border: 3px solid #f48ca0; /* 原来是 1px，这里变成三倍 */
  outline: none;
  background-color: #ffe6eb; /* 淡粉色填充 */
  color: #333333; /* 深灰色字体 */
  font-family: 'Roboto', sans-serif;
  font-size: 1.0em;
  font-weight: 400;
  line-height: 1.5rem;
  text-decoration: none;
  cursor: pointer;
  transition: all 150ms ease-out;
  width: 200px;
  letter-spacing: 1.6px;
  border-radius: 2px;
}

/* 保留 hover 和 focus 效果，根据需要也可以改颜色 */
select.form-select:focus,
select.form-select:hover {
  border-color: #ea4c89;
  background-color: #f8d7da; /* 可选：略微深一点的淡粉 hover 背景 */
}

select.form-select:active {
  border-color: #ea4c89;
  background-color: #f8d7da; /* 保持一致的点击反馈背景 */
}

</style>

        <!-- Back to top button -->
        <a id="back-to-top" title="Back to Top"></a>

        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js_test, then Bootstrap JS -->
        <script src="../static/js_test/jquery-3.2.1.min.js"></script>
        <script src="../static/js_test/pre-loader.js"></script>
        <script src="../static/assets/bootstrap/js/popper.min.js"></script>
        <script src="../static/assets/bootstrap/js/bootstrap.min.js"></script><!-- 引入 Leaflet -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
        <script src="../static/js_test/parallaxie.js"></script>
        <script src="../static/js_test/TweenMax.min.js"></script>
        <script src="../static/js_test/jquery.wavify.js"></script>
        <script src="../static/assets/wow/wow.min.js"></script>
        <script src="../static/js_test/main.js"></script>
        <script>
            $(document).ready(function () {
                // 初始化提示工具
                $('[data-toggle="tooltip"]').tooltip();

                // 搜索按鈕點擊事件
                document.getElementById('search-button').addEventListener('click', function (e) {
                    e.preventDefault(); // 阻止默認行為
                    const searchTerm = document.getElementById('search-input').value;
                    console.log('搜索按鈕點擊，關鍵詞:', searchTerm);
                    searchJobs(searchTerm);
                });

                // 輸入框回車事件
                document.getElementById('search-input').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        e.preventDefault(); // 阻止默認行為
                        const searchTerm = document.getElementById('search-input').value;
                        console.log('回車搜索，關鍵詞:', searchTerm);
                        searchJobs(searchTerm);
                    }
                });

                // 過濾器改變事件
                $('.form-select').change(function() {
                    applyFilters();
                });

                // 搜索職位函數
                function searchJobs(keyword) {
                    const searchParams = {
                        keyword: keyword,
                        location: $('#locationFilter').val(),
                        salary: $('#salaryFilter').val(),
                        education: $('#educationFilter').val(),
                        tag: $('#tagFilter').val(),
                        company: $('#companyFilter').val()
                    };

                    console.log('開始搜索，參數:', searchParams);

                    $.ajax({
                        url: '/search_jobs',
                        method: 'GET',
                        data: searchParams,
                        success: function (response) {
                            
                            if (response.success && response.jobs && response.jobs.length > 0) {
                                updateJobList(response.jobs);
                                // 顯示第一個職位的詳情
                                if (response.jobs.length > 0) {
                                    showJobDetail(response.jobs[0].job_id);
                                }
                            } else {
                                console.log('Nothing found');
                                $('#job_list').html('<p class="text-muted text-center py-4">No job listings found. Please try searching again.</p>');
                                $('#job_detail').html('<div class="text-center py-5"><p class="text-muted"></p></div>');
                            }
                        },
                        error: function (error) {
                            console.error('Error:', error);
                            $('#job_list').html('<p class="text-muted text-center py-4">Search error. Please try again.</p>');
                            $('#job_detail').html('<div class="text-center py-5"><p class="text-muted">Please try again later.</p></div>');
                        }
                    });
                }

                function updateJobList(jobs) {
    let jobHtml = '';
    let detailHtml = '';
    jobs.forEach(function (job, index) {
        jobHtml += `
            <div class="job_summary border rounded-3 p-3 mb-3 bg-light shadow-sm hover-shadow transition-all"
                 onclick="showJobDetail('${job.job_id}')" style="cursor: pointer;">
                <div class="d-flex justify-content-between align-items-start">
                    <h5 class="mb-3">${job.title}</h5>
                    <span class="badge bg-success">${job.salary}</span>
                </div>
                <div class="job-meta text-muted mb-2">
                    <small>
                        <i class="fas fa-map-marker-alt"></i> 📍 ${job.location} |
                        <i class="fas fa-briefcase"></i> 🧰 ${job.experience} |
                        <i class="fas fa-graduation-cap"></i> 🎓 ${job.education}
                    </small>
                </div>
                <p class="mb-2">${job.short_desc}</p>
                <div class="job-tags mt-3">
                    ${job.tags.split(',').map(tag =>
                        `<span class="badge bg-light text-dark border me-2">${tag.trim()}</span>`
                    ).join('')}
                </div>
            </div>
        `;

        detailHtml += `
            <div id="${job.job_id}" class="job_detail ${index === 0 ? '' : 'd-none'}"
                   data-lat="${job.latitude}" data-lng="${job.longitude}">
                <div class="job-header border-bottom pb-3 mb-4">
                    <h4 class="mb-3">${job.title}</h4>
                    <div class="job-meta d-flex flex-wrap gap-3">
                        <div class="meta-item">
                            <i class="fas fa-map-marker-alt text-danger"></i>
                            <strong>Location: </strong>${job.location}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-briefcase text-warning"></i>
                            <strong>Experience: </strong>${job.experience}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-graduation-cap text-info"></i>
                            <strong>Education: </strong>${job.education}
                        </div>
                    </div>

                </div>
                <div class="job-description">
                    <h5 class="mb-3">Description:</h5>
                    <div class="job-tags mt-3">
                        ${job.tags.split(',').map(tag =>
                            `<span class="badge bg-light text-dark border me-2">${tag.trim()}</span>`
                        ).join('')}
                    </div>
                    <ul class="list-unstyled">
                        ${job.full_desc.split('\n').map(line =>
                            `<li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> ${line}</li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        `;
    });
    $('#job_list').html(jobHtml);
    $('#job_detail').html(detailHtml);
}

                // 應用過濾器
                function applyFilters() {
                    const keyword = document.getElementById('search-input').value;
                    searchJobs(keyword);
                }

                // 初始化頁面時加載所有職位
                $(document).ready(function() {
                    searchJobs(''); // 加載所有職位
                });
            });

            let map; // 地图对象
            let marker; // 当前marker

            // 展示職位詳情
            function showJobDetail(id) {
                $('.job_detail').addClass('d-none');
                $(`#${id}`).removeClass('d-none');

                // 读取经纬度
                const $detail = $('#' + id);
                const lat = parseFloat($detail.data('lat'));
                const lng = parseFloat($detail.data('lng'));
                if (isNaN(lat) || isNaN(lng)) {
                    console.warn('The latitude and longitude is invalid.');
                    return;
                }

                // 第一次初始化地图
                if (!map) {
                  map = L.map('map').setView([lat, lng], 13);
                  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap'
                  }).addTo(map);
                  marker = L.marker([lat, lng]).addTo(map);
                } else {
                  map.setView([lat, lng], 13);
                  marker.setLatLng([lat, lng]);
                  // 强制 Leaflet 重新计算容器尺寸
                  map.invalidateSize();  // 确保瓦片正确显示 :contentReference[oaicite:7]{index=7}
                }

            }


        </script>
    </div>
</body>
</html>