<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="../static/img/favicon.ico" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../static/assets/bootstrap/css/bootstrap.min.css">
    <!-- icon css_test-->
    <link rel="stylesheet" href="../static/assets/elagent-icon/style.css">
    <link rel="stylesheet" href="../static/assets/animation/animate.css">
    <link rel="stylesheet" href="../static/css_test/style.css">
    <link rel="stylesheet" href="../static/css_test/responsive.css">
    <title>KbDoc</title>
    <style>
    .sign_right {
        background-image: url("../static/images/background5.jpg") !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
    }
</style>

</head>

<body data-scroll-animation="true">
    <div id="preloader">
        <div id="ctn-preloader" class="ctn-preloader">
            <div class="round_spinner">
                <div class="spinner"></div>
                <div class="text">
                    <img src="../static/img/spinner_logo.png" alt="">
                    <h4><span>KbDoc</span></h4>
                </div>
            </div>
            <h2 class="head">QUEENs NEVER CRY</h2>
            <p></p>
        </div>
    </div>
    <div class="body_wrapper">
        <section class="signup_area">
            <div class="row ml-0 mr-0">
                <div class="sign_left signin_left">
                    <h2>We are design changers do what matters.</h2>
                    <div class="round"></div>
                    <div class="avatar-name">
                    <img class="avatar-img" src="../static/images/Boran.jpg" alt="Boran">
                    <span class="name">Boran Duan</span>
            </div>

                </div>

                <div class="sign_right signup_right">
                    <div class="sign_inner signup_inner">
                        <div class="text-center">

                            <h3> HerBlossom</h3>
                            <div class="text">
                                If you do not have an account, please <a href="/register"
                                                                         class="link-primary">register</a>
                            </div>
                        </div>

                        <div class="divider">
                            <span class="or-text">or</span>
                        </div>
                        <form action="#" class="row login_form">
                            <div class="col-lg-12 form-group">
                                <div class="small_text">❥ Your email </div>
                                <input type="email" class="form-control" id="email" placeholder="info@KbDoc.com">
                            </div>
                            <div class="col-lg-12 form-group">
                                <div class="small_text">❥ Confirm password </div>
                                <div class="confirm_password">
                                    <input id="password" name="password" type="password" class="form-control" placeholder="5+ characters required" autocomplete="off">
                                    <a href="#" class="forget_btn">Forgotten password?</a>
                                </div>
                                    or you can choose <a href="/index">just view</a>

                            </div>

                            <div class="col-lg-12 text-center">
                                <button type="button" class="btn action_btn ban-button" onclick="clearForm()">Clear</button> <!-- Clear button -->
                                <button type="submit" class="btn action_btn thm_btn" onclick="validateForm()">Sign in</button>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js_test, then Bootstrap JS -->
    <script src="../static/js_test/jquery-3.2.1.min.js"></script>
    <script src="../static/js_test/pre-loader.js"> </script>
    <script src="../static/assets/bootstrap/js/popper.min.js"></script>
    <script src="../static/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/js_test/parallaxie.js"></script>
    <script src="../static/js_test/TweenMax.min.js"></script>
    <script src="../static/assets/wow/wow.min.js"></script>
    <script src="../static/js_test/main.js"></script>
<script>
    function checkEmailExists() {
      const emailInput = document.getElementById("email");
      const emailError = document.getElementById("email-error");
      const email = emailInput.value.trim();

      if (!email) {
        emailError.style.display = "none";
        return;
      }

      fetch("/check_email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.exists) {
            emailError.style.display = "none";
          } else {
            emailError.style.display = "block";
          }
        })
        .catch((error) => console.error("Error:", error));
    }

    // Attach the function to the email input field
    document.getElementById("email").addEventListener('input', checkEmailExists);

    // Function to validate and submit the form
    document.getElementById("signInForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
            alert("Please fill in all fields.");
            return;
        }

        fetch("/signin", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identification, email, password })
        })
            .then((response) => {
                if (response.redirected) {
                window.location.href = "/";
            } else {
                displayGeneralMessage( "An error occurred.");
            }
        })
        .catch(error => console.error("Error:", error));
    });

    // Display General Message
    function displayGeneralMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "alert alert-danger";
        messageDiv.textContent = message;
        document.getElementById("signInForm").prepend(messageDiv);

        setTimeout(() => messageDiv.remove(), 5000);
    }

    function displayBanMessage(message, banReason, timeLeftSeconds) {
       const banFeedback = document.getElementById("banFeedback");
       const banMessage = document.getElementById("banMessage");
       const banDetails = document.getElementById("banDetails");

       const hours = Math.floor(timeLeftSeconds / 3600);
       const minutes = Math.floor((timeLeftSeconds % 3600) / 60);
       const timeString = `${hours} hours and ${minutes} minutes`;

       banMessage.textContent = message;
       banDetails.innerHTML = `<strong>Reason:</strong> ${banReason}<br><strong>Time Remaining:</strong> ${timeString}`;
       banFeedback.style.display = "block";
   }

    // Clear Form Inputs
    function clearForm() {
        document.getElementById("signInForm").reset();
        document.getElementById("email-error").style.display = "none";
        document.getElementById("banFeedback").style.display = "none";
    }

</script>
</body>

</html>